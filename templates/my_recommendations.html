{% extends "layout.html" %}

{% block content %}
  <!-- Link to the recommendations-specific CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='my_recommendations.css') }}">

  <h2>Your Saved Recommendations</h2>

  <!-- Tabs for toggling between restaurant and meal results -->
  <div class="tab-buttons">
    <button class="tab-button active" onclick="showTab('foodies')">🍽️ Restaurants</button>
    <button class="tab-button" onclick="showTab('prep')">🥗 Meals</button>
  </div>

  <!-- FoodiesRN saved results section -->
  <div id="foodies" class="tab-content">
    <div class="card-section">
      <div class="section-header">
        <!-- Button to clear all saved restaurant results -->
        <form method="POST" action="{{ url_for('clear_foodiesrn') }}">
          <button type="submit">Clear All</button>
        </form>
      </div>

      {% if foodiesrn_results %}
        <div class="card-container">
          {% for r in foodiesrn_results %}
            <div class="card restaurant-card">
              <img src="{{ r.image_url }}" alt="Restaurant Image" class="card-img"
                onerror="this.onerror=null;this.src='https://st4.depositphotos.com/14953852/24787/v/450/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg';">
              
              <div class="card-content">
                <strong>{{ r.name }}</strong><br>
                <span class="location"><i class="fas fa-map-marker-alt"></i> {{ r.location }}</span><br>
                <div class="rating-price-inline">
                  <span class="rating">⭐ {{ r.rating }}</span>
                  <span class="price">💲{{ r.price }}</span>
                  {% if r.driving_distance_miles and r.driving_duration_minutes %}
                        <span class="distance">🚗 {{ "%.1f"|format(r.driving_distance_miles) }} mi</span>
                    {% elif r.distance_meters %}
                        <span class="distance">📏 {{ "%.1f"|format(r.distance_meters / 1609.344) }} mi</span>
                    {% endif %}
                </div>
                
                <div class="restaurant-actions">
                  <a href="{{ url_for('restaurant_detail', restaurant_name=r.name, restaurant_location=r.location) }}" 
                     class="details-btn">
                    <i class="fas fa-info-circle"></i> Details
                  </a>
                  <a href="https://www.google.com/maps/search/?api=1&query={{ (r.name + ' ' + r.location) | urlencode }}" 
                     target="_blank" class="details-btn">
                    <i class="fas fa-map-marker-alt"></i> Maps
                  </a>
                  <a href="{{ r.url }}" target="_blank" class="details-btn">
                    <i class="fab fa-yelp"></i> Yelp
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>No restaurants saved yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- PrepnGo saved results section -->
  <div id="prep" class="tab-content" style="display: none;">
    <div class="card-section">
      <div class="section-header">
        <!-- Button to clear all saved PrepnGo results -->
        <form method="POST" action="{{ url_for('clear_prepngo') }}">
          <button type="submit">Clear All</button>
        </form>
      </div>

      {% if prepngo_results %}
        <div class="card-container">
          {% for m in prepngo_results %}
            <div class="card meal-card">
              <div class="card-content">
                <strong>{{ m[0] }}</strong><br>
                <span class="price">💰 ${{ "%.2f"|format(m[1]) }}</span>
                <p class="meal-description">{{ m[2] }}</p>
                <a href="{{ m[3] }}" target="_blank" class="details-btn">
                  <i class="fas fa-external-link-alt"></i> View Recipe
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>No meals saved yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- function to toggle between tabs -->
  <script>
    function showTab(tabId) {
      // Hide all content sections
      document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
      // Show selected tab
      document.getElementById(tabId).style.display = 'block';

      // Update button styles to reflect active tab
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }
  </script>
{% endblock %}