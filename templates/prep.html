{% extends "layout.html" %}

{% block content %}
<!-- Link to Eat In stylesheet -->
<link rel="stylesheet" href="{{ url_for('static', filename='prep.css') }}">
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<main>
  <h2>Eat In</h2>

  <!-- Form to collect user's meal planning input -->
  <form method="POST" action="{{ url_for('prep') }}">

    <!-- Location input -->
    <label>
      Location: <br>
      <input type="text" name="location" placeholder="(e.g. Austin, TX)">
    </label>
    <br><br>

    <!-- Budget input -->
    <label>
      Budget: <br>
      <input type="number" step="0.01" name="budget" placeholder="($.$$)">
    </label>
    <br><br>

    <!-- Dietary restrictions checkboxes -->
    <fieldset>
      <legend>Dietary Restrictions:</legend>
      <label><input type="checkbox" name="diet" value="vegetarian"> Vegetarian</label><br>
      <label><input type="checkbox" name="diet" value="vegan"> Vegan</label><br>
      <label><input type="checkbox" name="diet" value="paleo"> Paleo</label><br>
      <label><input type="checkbox" name="diet" value="gluten free"> Gluten-free</label><br>
      <label><input type="checkbox" name="diet" value="lactose free"> Lactose-free</label><br>
      <label><input type="checkbox" name="diet" value="nut free"> Nut-free</label><br>
      <label><input type="checkbox" name="diet" value="halal"> Halal</label><br>
      <label><input type="checkbox" name="diet" value="kosher"> Kosher</label><br>
      <label><input type="checkbox" name="diet" value="keto"> Keto</label><br>
      <label><input type="checkbox" name="diet" value="pescatarian"> Pescatarian</label><br>
      <label><input type="checkbox" name="diet" value="low carb"> Low Carb</label><br>
      <label><input type="checkbox" name="diet" value="low sugar"> Low Sugar</label><br>
      <label><input type="checkbox" name="diet" value="other"> Other</label>
    </fieldset>
    <br>

    <!-- Servings input -->
    <label>
      How many people are you cooking for? <br>
      <input type="number" name="servings" min="1" placeholder="(e.g. 2)">
    </label>
    <br><br>

    <!-- Submit button to run the meal planner -->
    <button type="submit">Continue</button>
  </form>

  <!-- If results exist, display the generated meal plan -->
  {% if results %}
    <hr>
    <h3>ðŸ¥— Your Meal Plan:</h3>
    <ul>
      {% for m in results %}
        <li style="margin-bottom: 1em;">
          <strong>{{ m['title'] }}</strong> â€“ ${{ "%.2f"|format(m['price']) }}<br>
          {{ m['summary'] }}<br>
          <a href="{{ m['source_url'] }}" target="_blank">View Recipe</a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- Auto-scroll to the results if available -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const resultsExist = {{ 'true' if results else 'false' }};
      if (resultsExist) {
        const recSection = document.getElementById('recommendations');
        if (recSection) {
          recSection.scrollIntoView({ behavior: 'smooth' });
        }
      }
    });
  </script>
</main>
{% endblock %}
