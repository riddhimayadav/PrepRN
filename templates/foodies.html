{% extends "layout.html" %}

{% block content %}

<!-- Link to the CSS specific to the FoodiesRN Eat Out page -->
<link rel="stylesheet" href="{{ url_for('static', filename='foodies.css') }}">

<div class="eatout-wrapper">
  <h2>Find Your Next Spot</h2>

  <!-- Form to collect user's dining preferences -->
  <form method="POST" class="eatout-form" onsubmit="showLoading()">
    <!-- Location input field -->
    <div class="input-group">
      <label><i class="fas fa-map-marker-alt"></i> Location:</label>
      <input name="location" placeholder="(e.g., Austin, TX)" required>
    </div>
    <!-- Cuisine selection dropdown -->
    <div class="input-group">
      <label><i class="fas fa-utensils"></i> Food Type:</label>
      <select name="cuisine" required>
        <option>Thai</option>
        <option>Mexican</option>
        <option>Vegan</option>
        <option>American</option>
        <option>Chinese</option>
        <option>Barbeque</option>
        <option>Greek</option>
        <option>Indian</option>
        <option>Italian</option>
      </select>
    </div>
    <!-- Price selection dropdown -->
    <div class="input-group">
      <label><i class="fas fa-wallet"></i> Budget:</label>
      <select name="price" required>
        <option>$</option>
        <option>$$</option>
        <option>$$$</option>
        <option>$$$$</option>
      </select>
    </div>
    <!-- Vibe/mood selection dropdown -->
    <div class="input-group">
      <label><i class="fas fa-heart"></i> Vibe / Mood:</label>
      <select name="vibe" required>
        <option>Cozy</option>
        <option>Trendy</option>
        <option>Romantic</option>
        <option>Casual</option>
      </select>
    </div>
    <!-- Submit button to start restaurant search -->
    <button type="submit">Continue</button>
  </form>
  {% if error_msg %}
  <div class="error-msg" style="text-align: center; color: red; margin-top: 1em;">
    {{ error_msg }}
  </div>
  {% endif %}
  <!-- Loading message that appears after clicking "Continue" -->
  <div id="loading-msg" style="display:none; text-align:center; margin-top: 1em;">
  <p>üîç Generating your personalized recommendations...</p>
</div>
</div>

<!-- Show loading message when form is submitted -->
<script>
  function showLoading() {
    document.getElementById("loading-msg").style.display = "block";
  }
</script>

<!-- If results were returned, display them here -->
{% if results %}
<h3 id="recommendations">Top Recommendations:</h3>
<div class="recommendation-wrapper">
  {% for r in results %}
    <div class="recommendation">
      <img src="{{ r.image_url }}" alt="Restaurant Image"
         class="card-img"
         onerror="this.onerror=null;this.src='https://st4.depositphotos.com/14953852/24787/v/450/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg';">
      
      <div class="restaurant-content">
        <h4>{{ r.name }} ‚Äì {{ r.location }}</h4>
        <p>Rating: {{ r.rating }} | Price: {{ r.price }}</p>
        <p>{{ r.blurb }}</p>
        
        <div class="restaurant-actions">
          <a href="{{ r.detail_url }}" class="detail-btn">
            <i class="fas fa-info-circle"></i> View Details
          </a>
          <a href="{{ r.maps_url }}" target="_blank" class="maps-btn">
            <i class="fas fa-map-marker-alt"></i> Google Maps
          </a>
          <a href="{{ r.url }}" target="_blank" class="yelp-btn">
            <i class="fab fa-yelp"></i> Yelp
          </a>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% endif %}

<!-- If results exist, auto-scroll to the recommendations section -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const resultsExist = {{ 'true' if results else 'false' }};
    if (resultsExist) {
      const recSection = document.getElementById('recommendations');
      if (recSection) {
        recSection.scrollIntoView({ behavior: 'smooth' });
      }
    }
  });
</script>

{% endblock %}